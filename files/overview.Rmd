---
title: "Diving Logbook Overview"
author: "Ruben Perez Perez"
date: "`r Sys.Date()`"
output: 
  html_document:
      toc: true
      toc_float: true
      theme: cerulean
      df_print: kable 
        
---
<!-- "df_print: pages" can make pages out of the table-->

  
```{r global-options, include=FALSE}
# Sets size of the plots and saves them in a Fig folder
knitr::opts_chunk$set(fig.width=8, fig.height=5.34, fig.path='Figs/',
                      warning=FALSE, message=FALSE)

# Sets the working directory to parent directory of where the .Rmd is (usually in the files folder)
# knitr::opts_knit$set(root.dir = normalizePath(".."))

# Installs and calls the divewatchr R package
# devtools::install_github("rubenpp7/divewatchr")
# library(divewatchr)


```  

<br></br>

This document has been created using the [Divewatchr R package](https://github.com/rubenpp7/divewatchr) and it provides a thorough visualization and exploration of a SCUBA Diving Logbook through spatio-temporal and categorical plots and maps.
<i>Please note that some plots may seem incomplete. This is due to the lack of high quality data in the logbook, e.g. maximumDepthInMeters, locationID and bottomTime were not recorded for all the dives.</i>


<!-- Making tabs  
```{css echo=FALSE}
.tabset h2 {display: none;}
``` -->

# {.tabset .tabset-fade}

<!-- <h2>Maps and plots</h2> -->
## Maps and plots


### Dives distribution map

This is an interactive map with detailed information on each dive (<i>feel free to click and hover over the dive points to find more information about each dive</i>):

```{r echo=FALSE}
logbook_map() 
```

***
<br/><br/>

### Number of dive types

This barplot shows the number of dives per dive type and class. It reflects the diving experience of the diver regarding performance and type of training.

```{r echo=FALSE}
divetypes()
```

***
<br/><br/>

### Cumulative number of dives

This plot shows the cumulative number of dives over time. It reflects the overall diving experience of the diver.

```{r echo=FALSE}
cum_dives()
```

***
<br/><br/>

### Logged dives depths

This scatterplot shows the maximum depths of a number of dives over time. It reflects the experience of the diver regarding depth.

```{r echo=FALSE}
logged_depths()
```

***
<br/><br/>

### Dives per country and region

This barplot shows the number of dives per region and country. It reflects the experience of the diver regarding variety of divesites.

```{r echo=FALSE}
divecount_reg()
```

***
<br/><br/>

### Dive sites depths variation

This boxplot shows the maximum depth variation of each divesite according to the data collected from this logbook. This plot can be helpful for planning dives or trainings with specific depth requirements.

```{r echo=FALSE}
divesite_depths()
```

***
<br/><br/>

### Platform type dives

This barplot shows the number of dives per platform and region/country (boat, shore, pool). This plot gives a glimpse of the experience of the diver regarding the entrance to the water.

```{r echo=FALSE}
divetypes_platform()
```

***
<br/><br/>

<!-- <h2>Data</h2> -->
## Data 

### Highlights

```{r echo=FALSE, rows.print=15}
load('data/scuba_clean.RData')

tidyr::gather(data.frame("Number of dives" = as.character(nrow(scuba_clean)),
                         "Maximum depth" = paste0(max(as.numeric(scuba_clean$maximumDepthInMeters), na.rm = TRUE), " meters"),
                         "Total bottom time" = paste0(round(sum(as.numeric(scuba_clean$bottomTime), na.rm = TRUE)/60), " hours"),
                         "Maximum bottom time in a dive" = paste0(max(as.numeric(scuba_clean$bottomTime), na.rm = TRUE), " minutes"),
                         "Diving since" = paste0(round(as.numeric(difftime(Sys.Date(), min(scuba_clean$eventDate), units = "days"))/365.25), " years ago"),
                         "Last dive" = paste0(max(scuba_clean$eventDate),
                                              " = ",
                                              paste0(round(as.numeric(difftime(Sys.Date(), max(scuba_clean$eventDate), units = "days"))), " days ago")),
                         "Number of dive sites" = nrow(dplyr::distinct(dplyr::select(scuba_clean, locationID))) ), 
               key = "key", 
               value = "value")

# dplyr::transmute(scuba_clean, maximumDepth = max(as.numeric(scuba_clean$maximumDepthInMeters), na.rm = TRUE))
```

***
<br/><br/>

### Logbook data

```{r echo=FALSE, rows.print=15}
load('data/scuba_clean.RData')

dplyr::transmute (scuba_clean, eventDate, locationID, locality, maximumDepth = maximumDepthInMeters, bottomTime, diveType, diveClass, platformType, region, country)
```

***
<br/><br/>

<!-- <h2>Data</h2> -->
## Certifications 

Still under construction

```{r echo=FALSE}
# setwd("C:/Users/rubenp/Desktop/Huiswerk 2020/Logbook Scuba Ruben Perez/divewatchr")
# load('data/scuba_map.RData')
# load('data/scuba_clean.RData')

#scuba_clean[92:101,] %>% select (rowid, eventDate, locationID, locality, region, country, 
#                                maximumDepthInMeters, bottomTime, diveType,
#                                platformType, diveClass, decimalLongitude, decimalLatitude)
```